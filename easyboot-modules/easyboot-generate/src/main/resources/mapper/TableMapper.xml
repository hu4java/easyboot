<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hu4java.generate.mapper.TableMapper">
    <resultMap type="com.hu4java.generate.entity.Table" id="tableMap">
        <result column="table_name" property="name"/>
        <result column="table_comment" property="comment"/>
        <result column="table_schema" property="schema"/>

        <collection property="columnList" ofType="column" column="table_name"
                    select="com.hu4java.generate.mapper.ColumnMapper.selectByTableName" />

    </resultMap>

    <sql id="allColumnSql">
        t.table_name,
        t.table_comment,
        t.table_schema
    </sql>

    <sql id="searchSql">
        <where>
            <if test="condition.name != null and condition.name != ''">
                AND t.name LIKE CONCAT('%', #{condition.name}, '%')
            </if>
        </where>
    </sql>

    <select id="selectByTableName" resultMap="tableMap">
        select <include refid="allColumnSql"/>
        from information_schema.TABLES t
        where t.table_schema = database() and t.table_name = #{tableName}
    </select>

    <select id="selectByCondition" resultMap="tableMap">
        select <include refid="allColumnSql"/>
        from sys_dept t1
        left join sys_user_dept t2 on t1.id = t2.dept_id
        where t2.user_id = #{userId}
    </select>

</mapper>